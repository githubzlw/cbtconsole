package com.cbt.parse.service;


import org.slf4j.LoggerFactory;

import java.util.Random;
import java.util.regex.Pattern;

public class IpSelect {
	private final static org.slf4j.Logger LOG = LoggerFactory.getLogger(IpSelect.class);
	private static int count = 0;
//	private static String pat = "(81.17[67].\\d+.\\d+)|(80.241.\\d+.\\d+)|(80.240.2((0[8-9])|(1[0-9])|(2[0-3])).\\d+)"
//			                  + "|(80.237.\\d+.\\d+)|(81.92.1(([123]\\d)|(4[0-3])).\\d+)|(80.94.((1[6-9])|([2-3][0-9])|(4[0-7])).\\d+)";
	
	
	private static String pat = "(81\\.((17[67].\\d+)|(9[0-5]\\.\\d+))\\.\\d+)|"
			+ "(80\\.((94.((1[6-9])|([2-3][0-9])|(4[0-7])))|((2(37)|(41))\\.\\d+)|(240.2((0[8-9])|(1[0-9])|(2[0-3]))))\\.\\d+)";
	
	/**内存随机取ip
	 * @return
	 */
	public static String get(){
		String[] ip = new String[]{
			"8.225.186.27",
			"18.85.28.209",
			"23.91.25.96",
			"23.100.39.41",
			"45.55.165.152",
			"50.157.172.214",
			"50.200.101.172",
			"54.183.236.23",
			"54.187.52.159",
			"64.62.233.67",
			"64.167.187.135",
			"64.186.47.179",
			"67.80.234.171",
			"199.168.148.131",
			"199.168.148.146",
			"199.168.148.147",
			"199.168.148.148",
			"199.168.148.150",
			"199.168.148.151",
			"199.168.148.152",
			"199.189.84.217",
			"199.200.120.36",
			"199.200.120.37",
			"71.184.76.9",
			"72.159.148.20",
			"72.172.186.194",
			"93.188.167.189",
			"97.77.104.22",
			"184.172.117.120",
			"198.2.202.49",
			"198.150.101.52",
			"207.91.10.234",
			"208.40.250.69",
			"104.207.128.73",
			"104.236.87.96",
			"162.208.49.45",
			"162.216.0.221",
			"165.138.124.4",
			"168.213.3.106",
			"170.75.154.231",
			"173.82.2.234",
			"173.201.183.172",
			"173.237.197.138",
			"216.124.89.28",
			"216.84.169.214"
		};
		String result = "63.241.31.55";
		if(count<ip.length){
			result = ip[count];
			count ++;
		}else{
			count = 0;
			result = ip[count];
		}
		ip = null;
		LOG.warn("get() ip:"+result);
		return result;
	}
	
	
	
	/**获取ip
	 * @param url
	 * @param falg
	 * @return
	 */
	public static String ip(){
		int cycle = 0;
		String ip = getRandomIp();
		while((ip==null||ip.isEmpty())&&cycle<2){
			ip = getRandomIp();
			cycle++;
		}
		if(ip==null||ip.isEmpty()){
			ip = get();
		}
		return ip;
	}
	
	private static String filter(String ip){
		if(ip!=null){
			
			if("80.237.108.232".equals(ip)){
				ip = null;
			}else if(Pattern.compile(pat).matcher(ip).matches()){//1370488832-1370554367
				ip = null;
			}
		}
		return ip;
	}
	
	 public static void main(String[] args) {
	    	String ip = "81.92.47.255";//"81.94.47.255"
	    	ip = filter(ip);
	    	
			System.out.println(ip);
	    	
		}
	
	/*
     * 随机生成国外IP地址
     */
    public static String getRandomIp(){
        //ip范围
        int[][] range = {{50331648,67108863},
                         {150994944,167772159},
                         {201338880,201342975},
                         {1364918272,1365266175},
                         {1365448960,1365449215},
                         {1365449216,1365468927},
                         {1365468928,1365469695},
                         {67108864,67829759},
                         {201699568,201699583},
                         {69944576,69944671},
                         {69944672,83886079},
                         {1365469696,1365528575},
                         {1365528576,1365532671},
                         {1366274816,1367678463},
                         {1368935168,1368946943},
                         {201773056,201777151},
                         {67829760,67895295},
                         {1365614336,1365693439},
                         {1365693440,1365693695},
                         {1365963264,1365963519},
                         {69811712,69944575},
                         {1368946944,1370397951},
                         {1370397952,1370488831},
                         {202430464,202431487},
                         {1365772032,1365799935},
                         {202630656,202630911},
                         {1365800192,1365835775},
                         {202790144,202790399},
                         {202813952,202814463},
                         {67895296,68374015},
                         {69590016,69811455},
                         {1365532672,1365614079},
                         {1365614080,1365614335},
                         {1365963520,1366126079},
                         {1366126080,1366274815},
                         {69811456,69811711},
                         {1365770240,1365771775},
                         {204266880,204267007},
                         {1365799936,1365800191},
                         {208347584,208347647},
                         {1365266176,1365266431},
                         {1365266432,1365358335},
                         {1365358336,1365358591},
                         {1365447936,1365448959},
                         {211366912,211367935},
                         {1365693696,1365704703},
                         {1365925888,1365929983},
                         {211460096,211460351},
                         {1365771776,1365772031},
                         {211812352,211877887},
                         {1367678464,1367678719},
                         {212367616,212367871},
                         {212819968,212819975},
                         {1367678720,1368923903},
                         {403701760,403767295},
                         {403767296,403832831},
                         {1368923904,1368924159},
                         {202223744,202223871},
                         {1368924160,1368934911},
                         {403832832,403898367},
                         {201500928,201501183},
                         {1365358592,1365447679},
                         {1365447680,1365447935},
                         {403898368,404226047},
                         {404226048,404676607},
                         {404676608,404692991},
                         {201778688,201779199},
                         {1365835776,1365925887},
                         {404692992,404750335},
                         {404750336,404815871},
                         {1365704704,1365770239},
                         {201557504,201558015},
                         {68530544,68530559},
                         {69500032,69500159},
                         {404815872,404881407},
                         {404881408,404946943},
                         {404946944,404979711},
                         {68530560,68530687},
                         {404979712,405012479},
                         {1365929984,1365963263},
                         {405012480,405028863},
                         {405028864,405078015},
                         {201326592,201338879},
                         {201342976,201500927},
                         {201501184,201557503},
                         {201558016,201699567},
                         {201699584,201773055},
                         {201777152,201778687},
                         {68374016,68374271},
                         {201779200,202083071},
                         {202083328,202223743},
                         {202223872,202430463},
                         {68530688,69500031},
                         {202814464,203026143},
                         {68374272,68374335},
                         {203026176,203881983},
                         {68374336,68530543},
                         {204328352,208347583},
                         {204267008,204328335},
                         {211256064,211366911},
                         {211367936,211448831},
                         {211449344,211460095},
                         {69500160,69500927},
                         {211460352,211812351},
                         {212819976,218103807},
                         {69500928,69588991},
                         {234881024,251658239},
                         {285212672,301989887},
                         {301989888,318767103},
                         {318767104,335544319},
                         {405078016,405143551},
                         {405143552,405147647},
                         {405147648,405209087},
                         {1368934912,1368935167},
                         {405241856,405274623},
                         {69588992,69590015},
                         {405274624,405295103},
                         {405295104,405299199},
                         {405299200,405303295},
                         {208347648,208618879},
                         {405526272,405527807},
                         {208619008,211255807},
                         {405209088,405241855},
                         {202431488,202630655},
                         {405798912,405892351},
                         {202630912,202790143},
                         {405892608,406061055},
                         {202083072,202083327},
                         {202790400,202813951},
                         {405303296,405526271},
                         {405527808,405536767},
                         {405892352,405892607},
                         {406061056,406339583},
                         {203882016,204266879},
                         {406339584,406347775},
                         {406347776,406351871},
                         {211877888,212367615},
                         {406351872,406355967},
                         {406355968,406372351},
                         {212367872,212819967},
                         {406372352,406388735},
                         {406388736,406454271},
                         {406454272,406585343},
                         {406847488,406913023},
                         {406913024,407183871},
                         {407183872,407184127},
                         {407184128,407240447},
                         {407240448,407349759},
                         {407349760,407399679},
                         {407399680,407399935},
                         {407399936,407404543},
                         {407404544,407407359},
                         {1357187584,1357187839},
                         {407437312,407438335},
                         {407438336,407438591},
                         {407438592,407502847},
                         {1359411200,1359411455},
                         {407502949,407564287},
                         {407564288,407568383},
                         {407568384,407633919},
                         {407633920,407641599},
                         {407641600,407792383},
                         {1342342656,1342342911},
                         {1363968000,1364003071},
                         {407792384,407860735},
                         {407860736,407860991},
                         {407860992,407899391},
                         {407899392,407994879},
                         {407994880,407996415},
                         {1364003072,1364003327},
                         {407996416,408223231},
                         {408223232,408237311},
                         {408237312,408237567},
                         {408237568,408285695},
                         {1358397440,1358405631},
                         {408285696,408285951},
                         {408285952,408299007},
                         {408299008,408299263},
                         {1359411456,1359429631},
                         {408299264,408319231},
                         {408319232,408319487},
                         {408319488,408361983},
                         {1358048000,1358048255},
                         {408361984,408362239},
                         {408362240,408362624},
                         {408362625,408416767},
                         {408416768,408420351},
                         {408420352,408471039},
                         {408471040,408471295},
                         {408471296,408485887},
                         {408485888,408494079},
                         {408551424,408682495},
                         {408682496,408719359},
                         {408719360,408723455},
                         {408723456,409010175},
                         {409010176,409075711},
                         {409075712,409206783},
                         {409206784,409303039},
                         {409303040,409310719},
                         {409310720,409323775},
                         {409323776,409337855},
                         {409337856,409415935},
                         {409415936,409416191},
                         {409416192,409420287},
                         {409420288,409438975},
                         {409438976,409439231},
                         {409439232,409468927},
                         {409468928,409509887},
                         {409509888,409534463},
                         {409534464,409550847},
                         {409550848,409567231},
                         {409567232,409583615},
                         {409583616,409587711},
                         {409587712,409599999},
                         {409600000,409665535},
                         {409665536,409731071},
                         {409731072,409750015},
                         {409750016,409750271},
                         {1027919104,1027919359},
                         {1364182784,1364197375},
                         {409750272,410039295},
                         {410039296,410039551},
                         {1029641728,1029652479},
                         {410039552,410145535},
                         {410145536,410145791},
                         {410145792,410155007},
                         {410155008,410166783},
                         {1342382336,1342391295},
                         {410166784,410170367},
                         {410170368,410189823},
                         {410255360,410386431},
                         {1342391296,1342391551},
                         {410386432,410451967},
                         {1353779200,1353842687},
                         {410451968,410517503},
                         {410517504,410583039},
                         {1046315008,1046315519},
                         {411172864,411303935},
                         {410583040,410607615},
                         {1354760192,1354891263},
                         {410648576,410677247},
                         {410714112,410779647},
                         {410779648,410804223},
                         {1364182528,1364182783},
                         {410804224,410845183},
                         {410845184,411140095},
                         {1342199808,1342200063},
                         {411140096,411156479},
                         {1357187840,1357222655},
                         {411156480,411164671},
                         {411566080,411622399},
                         {1364026368,1364026623},
                         {411622400,411622655},
                         {1364026624,1364063487},
                         {411622656,411631615},
                         {411631616,411639807},
                         {1364063744,1364182527},
                         {411652864,411653119},
                         {1048313856,1048510463},
                         {411697152,411717631},
                         {1364063488,1364063743},
                         {1357619200,1357709310},
                         {411828224,411852799},
                         {411893760,411943679},
                         {411943680,411943935},
                         {1357222656,1357222911},
                         {411943936,411983871},
                         {411983872,411992063},
                         {1027894784,1027895039},
                         {1342441984,1342442239},
                         {411992064,412033023},
                         {412033024,412037119},
                         {1048117248,1048125439},
                         {1342442240,1342676991},
                         {412037120,412090367},
                         {412090368,412106751},
                         {1357611008,1357619199},
                         {412106752,412155903},
                         {1047273472,1047281663},
                         {412155904,412221439},
                         {1342676992,1342677247},
                         {412221440,412229631},
                         {1027791360,1027894783},
                         {1027895040,1027919103},
                         {412229632,412286975},
                         {1029177344,1029242879},
                         {412286976,412352511},
                         {412352512,412377087},
                         {412377088,412388863},
                         {1024046336,1024065535},
                         {1342391552,1342441983},
                         {1342677248,1342701567},
                         {412389120,412418047},
                         {1024042240,1024046335},
                         {1354891264,1354895359},
                         {412388864,412389119},
                         {412418048,412426239},
                         {1048608768,1048616959},
                         {412426240,412483583},
                         {1354935040,1354935295},
                         {1354935296,1355022335},
                         {412483584,412549119},
                         {1029641472,1029641727},
                         {412549120,412614655},
                         {1024032768,1024042239},
                         {1356922880,1357187583},
                         {1354895360,1354935039},
                         {412647424,412745727},
                         {1353777152,1353779199},
                         {1023975424,1023983615},
                         {1027919360,1027997695},
                         {1029636352,1029641471},
                         {412888576,412888831},
                         {412811264,412827647},
                         {1353646080,1353777151},
                         {1046319104,1046323199},
                         {412827648,412885503},
                         {412885504,412885759},
                         {1342342912,1342382079},
                         {1046282240,1046290431},
                         {412885760,412888575},
                         {412888832,412897279},
                         {1023934464,1023959039},
                         {412897280,412940031},
                         {1342177280,1342199807},
                         {412940032,412966655},
                         {1342200064,1342342655},
                         {412745728,412811263},
                         {1364003328,1364026367},
                         {412966656,412966679},
                         {1048625152,1048633343},
                         {1370682624,1370682879}
                         
        };
        Random rdint = new Random();
        int length = range.length;
        int index = rdint.nextInt(length);
    	String ip = num2ip(range[index][0]+new Random().nextInt(range[index][1]-range[index][0]));
    	if(!Pattern.compile("(\\d+\\.\\d+\\.\\d+\\.\\d+)").matcher(ip).matches()){
    		ip = null;
    	}
    	ip = filter(ip);
    	return ip;
      }
    
    /*
     * 将十进制转换成ip地址
     */
    public static String num2ip(int ip) {
        int [] b=new int[4] ;
        String x = "";
        
        b[0] = (int)((ip >> 24) & 0xff);
        b[1] = (int)((ip >> 16) & 0xff);
        b[2] = (int)((ip >> 8) & 0xff);
        b[3] = (int)(ip & 0xff);
        x= Integer.toString(b[0])+"."+
        		Integer.toString(b[1])+"."+
        		Integer.toString(b[2])+"."+
        		Integer.toString(b[3]);
        return x; 
     }
    
	
	
}
